-- MySQL Script generated by MySQL Workbench
-- Wed Sep 21 16:25:39 2022
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema optica
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema optica
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `optica` DEFAULT CHARACTER SET utf8 ;
USE `optica` ;

-- -----------------------------------------------------
-- Table `proveidor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `proveidor` (
  `proveidor_id` INT NOT NULL AUTO_INCREMENT,
  `nom` VARCHAR(60) NOT NULL,
  `carrer` VARCHAR(128) NOT NULL,
  `numero` VARCHAR(10) NOT NULL,
  `pis` VARCHAR(10) NOT NULL,
  `porta` VARCHAR(10) NOT NULL,
  `ciutat` VARCHAR(45) NOT NULL,
  `codi_postal` VARCHAR(10) NOT NULL,
  `pais` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(20) NOT NULL,
  `fax` VARCHAR(20) NULL,
  `nif` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`proveidor_id`),
  UNIQUE INDEX `nif_UNIQUE` (`nif` ASC),
  UNIQUE INDEX `nom_UNIQUE` (`nom` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `marca`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `marca` (
  `marca_id` INT NOT NULL AUTO_INCREMENT,
  `marca_nom` VARCHAR(45) NOT NULL,
  `proveidor_id` INT NOT NULL,
  PRIMARY KEY (`marca_id`),
  UNIQUE INDEX `marca_nom_UNIQUE` (`marca_nom` ASC),
  INDEX `fk_marca_proveidor1_idx` (`proveidor_id` ASC),
  CONSTRAINT `fk_marca_proveidor1`
    FOREIGN KEY (`proveidor_id`)
    REFERENCES `proveidor` (`proveidor_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `client`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `client` (
  `client_id` INT NOT NULL AUTO_INCREMENT,
  `nom` VARCHAR(60) NOT NULL,
  `carrer` VARCHAR(128) NOT NULL,
  `numero` VARCHAR(10) NOT NULL,
  `pis` VARCHAR(10) NULL,
  `porta` VARCHAR(10) NULL,
  `ciutat` VARCHAR(45) NOT NULL,
  `codi_postal` VARCHAR(10) NOT NULL,
  `pais` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(20) NOT NULL,
  `correo_eletronic` VARCHAR(128) NOT NULL,
  `data_registre` DATETIME NOT NULL,
  `recomanat_client_id` INT NULL,
  PRIMARY KEY (`client_id`),
  INDEX `fk_client_client1_idx` (`recomanat_client_id` ASC),
  CONSTRAINT `fk_client_client1`
    FOREIGN KEY (`recomanat_client_id`)
    REFERENCES `client` (`client_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `empleat`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `empleat` (
  `empleat_id` INT NOT NULL AUTO_INCREMENT,
  `nom` VARCHAR(60) NOT NULL,
  `carrer` VARCHAR(128) NOT NULL,
  `numero` VARCHAR(10) NOT NULL,
  `pis` VARCHAR(10) NULL,
  `porta` VARCHAR(10) NULL,
  `ciutat` VARCHAR(45) NOT NULL,
  `codi_postal` VARCHAR(10) NOT NULL,
  `pais` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(20) NOT NULL,
  `correo_eletronic` VARCHAR(128) NOT NULL,
  `data_registre` DATETIME NOT NULL,
  PRIMARY KEY (`empleat_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `ulleres`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `ulleres` (
  `ulleres_id` INT NOT NULL AUTO_INCREMENT,
  `client_id` INT NOT NULL,
  `marca_id` INT NOT NULL,
  `graduacio_i` FLOAT NOT NULL,
  `graduacio_d` FLOAT NOT NULL,
  `preu` FLOAT NOT NULL,
  `color_muntura` VARCHAR(45) NULL,
  `tipo_muntura` ENUM('flotant', 'pasta', 'metàllica') NULL,
  `color_vidre_i` VARCHAR(45) NULL,
  `color_vidre_d` VARCHAR(45) NULL,
  `empleat_id` INT NOT NULL,
  `data_compra` DATETIME NOT NULL,
  PRIMARY KEY (`ulleres_id`),
  INDEX `marca_id_idx` (`marca_id` ASC),
  INDEX `fk_ulleres_client1_idx` (`client_id` ASC),
  INDEX `fk_ulleres_empleat1_idx` (`empleat_id` ASC),
  CONSTRAINT `marca_id`
    FOREIGN KEY (`marca_id`)
    REFERENCES `marca` (`marca_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_ulleres_client1`
    FOREIGN KEY (`client_id`)
    REFERENCES `client` (`client_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_ulleres_empleat1`
    FOREIGN KEY (`empleat_id`)
    REFERENCES `empleat` (`empleat_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

#
# DATA FOR: client
#

INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (1, 'Celia Hudson PhD', 'Miller Junction', '306', '6', '8', ' Castedefells', '23637', 'España', '(952)361-3717x5487', 'antonetta10@gmail.com', '2000-02-09 18:17:02', NULL);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (2, 'Dr. Kayla Lubowitz I', 'Sanford Stream', '50', '5', '5', ' Castedefells', '43338-8726', 'España', '05953137023', 'lesley97@gmail.com', '2009-04-04 00:56:46', NULL);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (3, 'Layla Mraz', 'Maurice Crossing', '330', '5', '7', 'Barcelona', '91796', 'España', '242-396-7586x33023', 'lschamberger@hotmail.com', '2018-10-07 20:11:05', 1);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (4, 'Leonora Baumbach', 'Gregoria Estates', '125', '7', '1', ' Valencia', '20126', 'España', '(488)738-5680x8649', 'dorcas16@waelchi.com', '1993-10-29 02:00:17', NULL);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (5, 'Prof. Annabelle Pfannerstill', 'Sydni Inlet', '391', '', '7', 'Barcelona', '50213', 'España', '083-776-3172', 'glenna.fadel@hotmail.com', '1993-09-15 14:56:30', NULL);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (6, 'Esteban Kunze', 'Roberts Crossing', '459', '3', '', ' Castedefells', '78101', 'España', '1-789-268-6635x493', 'vschmeler@gottlieb.com', '1995-06-17 18:00:32', 1);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (7, 'Evie O\'Kon', 'Rogers Knolls', '174', '8', '4', ' Castedefells', '55151', 'España', '(791)216-2729', 'twalter@thompson.net', '1972-03-23 01:46:36', 3);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (8, 'Carleton Murazik', 'Rebekah Street', '446', '9', '', ' Sitges', '25290', 'España', '516.675.1951', 'rozella.bins@kuhlman.org', '1978-05-06 19:46:51', 3);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (9, 'Mrs. Jazlyn Little', 'Cummings Route', '266', '5', '6', ' Hospitalet', '66831', 'España', '1-661-629-1896', 'clemens.bartoletti@bechtelar.com', '2006-02-28 17:45:10', 5);
INSERT INTO `client` (`client_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`, `recomanat_client_id`) VALUES (10, 'Heath Cormier', 'Chester Skyway', '275', '9', '9', ' Hospitalet', '10539-1017', 'España', '007.899.0851', 'olowe@yahoo.com', '1989-05-30 23:08:24', 3);

#
# DATA FOR: proveidor
#

INSERT INTO `proveidor` (`proveidor_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `fax`, `nif`) VALUES (1, 'Gislason-Cruickshank', 'Zemlak Green', '437', '6', '2', 'North', '14771', 'España', '(725)247-7185', '926-676-9798x183', 'e03721990');
INSERT INTO `proveidor` (`proveidor_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `fax`, `nif`) VALUES (2, 'Rolfson, Brakus and Roberts', 'Purdy Burgs', '413', '2', '3', 'North', '23511-3518', 'España', '1-983-490-6259x23107', '(032)250-1503', 'i91995096');
INSERT INTO `proveidor` (`proveidor_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `fax`, `nif`) VALUES (3, 'Schumm Inc', 'Glover Ranch', '56', '9', '5', 'West', '81460', 'España', '(451)670-9770x04859', '012-085-3590', 'o59647020');
INSERT INTO `proveidor` (`proveidor_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `fax`, `nif`) VALUES (4, 'Daugherty, Bogisich and Brakus', 'Jabari Locks', '326', '3', '', 'Lake', '10140', 'España', '00574722640', '252.525.3117x4929', 'c61647778');
INSERT INTO `proveidor` (`proveidor_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `fax`, `nif`) VALUES (5, 'Weber, Lynch and Dach', 'Giuseppe Place', '300', '', '9', 'South', '80127-2456', 'España', '02147680285', '1-825-051-0528', 'i02326043');
INSERT INTO `proveidor` (`proveidor_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `fax`, `nif`) VALUES (6, 'Sunglass', 'Leiva', '11', '', '9', 'Barcelona', '08014', 'España', '62147680233', '6519-0528', 'B02326432');


#
# DATA FOR: empleat
#

INSERT INTO `empleat` (`empleat_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`) VALUES (1, 'Raheem Sipes III', 'Hayes Mall', '50', '8', '3', 'North Juanita', '17226-4740', 'España', '623-736-148', 'sherwood51@gmail.com', '1974-07-18 05:27:35');
INSERT INTO `empleat` (`empleat_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`) VALUES (2, 'Lila Emmerich', 'Alberto Trail', '40', '1', '', 'West Kiaraview', '68283', 'España', '613-003-552', 'gdickinson@heidenreich.info', '2015-12-11 09:57:04');
INSERT INTO `empleat` (`empleat_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`) VALUES (3, 'Freddie Homenick', 'Niko Flats', '09', '9', '', 'Denesikchester', '23622-0804', 'España', '692-856-608', 'dylan55@gmail.com', '1991-04-27 22:48:26');
INSERT INTO `empleat` (`empleat_id`, `nom`, `carrer`, `numero`, `pis`, `porta`, `ciutat`, `codi_postal`, `pais`, `telefono`, `correo_eletronic`, `data_registre`) VALUES (4, 'Dr. Rusty Wiza IV', 'Meagan Rue', '58', '4', '1', 'Luettgenport', '48929', 'España', '638-056-500', 'jacobi.arnold@hotmail.com', '2016-05-31 09:56:39');


#
# DATA FOR: marca
#

INSERT INTO `marca` (`marca_id`, `marca_nom`, `proveidor_id`)
VALUES (1, 'corrupti', 4),
       (2, 'explicabo', 3),
       (3, 'rerum', 3),
       (4, 'labore', 1),
       (5, 'sint', 4),
       (6, 'commodi', 2),
       (7, 'consectetur', 3),
       (8, 'recusandae', 5),
       (9, 'inventore', 5),
       (10, 'quia', 3),
       (11, 'omnis', 4),
       (12, 'eos', 4),
       (13, 'et', 5),
       (14, 'cupiditate', 2),
       (15, 'nulla', 2),
       (16, 'harum', 3),
       (17, 'earum', 2),
       (18, 'eligendi', 5),
       (19, 'eius', 4),
       (20, 'aut', 5),
       (21, 'dolorem', 3),
       (22, 'corporis', 5),
       (23, 'quos', 1),
       (24, 'nobis', 3),
       (25, 'dolores', 5);

#
# DATA FOR: ulleres
#

INSERT INTO `ulleres`
VALUES (1,5,24,5.6,0.7,135.19,'olive','pasta',' azul',' verde',1,'2020-02-20 21:36:50'),
       (2,6,20,4.4,4.8,68.97,'green','pasta',' negro','transparente',4,'2020-06-29 06:24:41'),
       (3,5,23,2.9,0.1,52.2,'green','metàllica',' azul',' negro',1,'2020-01-02 18:07:02'),
       (4,5,18,5.2,4.2,43.24,'maroon','metàllica',' rojo',' azul',4,'2019-11-25 16:58:40'),
       (5,3,12,4.8,3,142.1,'green','flotant',' amarillo',' azul',1,'2021-04-22 11:09:01'),
       (6,6,11,5.2,3.4,75.55,'fuchsia','flotant','transparente',' rojo',4,'2022-01-16 05:59:00'),
       (7,1,6,5.9,2.6,74.14,'navy','pasta','transparente',' azul',4,'2021-07-25 14:26:31'),
       (8,7,25,5.9,3.3,46.83,'fuchsia','pasta',' azul',' azul',4,'2019-10-09 03:55:59'),
       (9,4,15,2.2,2.7,143.7,'maroon','metàllica',' verde','transparente',3,'2022-07-15 17:25:06'),
       (10,8,15,5.7,0.7,33.64,'gray','metàllica',' verde',' amarillo',1,'2020-02-09 11:49:03'),
       (11,3,2,3.8,1.5,107.62,'aqua','pasta','transparente',' negro',4,'2022-02-27 13:21:13'),
       (12,5,15,2.8,6,114.56,'gray','flotant',' rojo',' azul',4,'2019-11-12 22:22:10'),
       (13,5,2,5,3.2,71.01,'silver','flotant',' negro',' amarillo',3,'2020-03-31 02:06:09'),
       (14,7,12,1,4,46.48,'maroon','flotant',' rojo',' azul',2,'2022-05-30 03:35:33'),
       (15,6,20,2.1,4.5,56.9,'olive','metàllica','transparente',' verde',4,'2021-03-25 18:39:07'),
       (16,8,9,1.5,5.9,87.1,'black','pasta',' azul','transparente',1,'2020-05-21 17:05:56'),
       (17,6,9,2.9,5.8,93.45,'fuchsia','metàllica',' verde',' negro',2,'2021-11-30 02:16:18'),
       (18,3,2,3,0.9,76.23,'teal','pasta',' negro',' amarillo',2,'2020-01-24 23:40:50'),
       (19,2,11,5.8,2.9,98.4,'purple','metàllica',' rojo',' verde',4,'2021-01-31 05:02:21'),
       (20,9,6,1.4,2.4,124,'blue','pasta',' amarillo',' verde',3,'2020-12-06 09:43:10');
       
#--- Llista el total de factures d'un client/a en un període determinat.
SELECT client_id, nom, preu, data_compra
FROM client
JOIN ulleres 
	USING (client_id)
WHERE client_id = 5 AND 
data_compra BETWEEN '2020-01-01' AND '2020-06-30';

SELECT client_id, nom, ROUND(SUM(preu),2) 'TOTAL FACTURES'
FROM client
JOIN ulleres 
	USING (client_id)
WHERE client_id = 5 AND 
data_compra BETWEEN '2020-01-01' AND '2020-06-30'
GROUP BY client_id;

#--- Llista els diferents models d'ulleres que ha venut un empleat/da durant un any.
SELECT DISTINCT(marca_nom) AS marca, COUNT(marca_nom) AS 'cantidad venut'
FROM ulleres
JOIN empleat
	USING (empleat_id)
JOIN marca
	USING (marca_id)
WHERE empleat_id = 4 AND
YEAR(data_compra) = 2019
GROUP BY marca_nom;


#--- Llista els diferents proveïdors que han subministrat ulleres venudes amb èxit per l'òptica.
SELECT nom, ROUND(SUM(preu),2) AS 'Total Ventas', COUNT(ulleres_id) AS Num_ventas
FROM proveidor
LEFT JOIN marca USING (proveidor_id)
LEFT JOIN ulleres USING (marca_id)
GROUP BY nom
ORDER BY Num_ventas DESC
